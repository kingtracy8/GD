<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>电脑归还</title>
    <link rel="stylesheet" href="../js/css/layui.css">
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/layui.js"></script>
    <!--Create By: linsong.wei   2017-11-27 16:02:53-->
</head>
<body>

<blockquote class="layui-elem-quote layui-text" style="margin-top: 10px">
    您好，下方表格中是您的已通过管理员审核的申请记录，您现在可以将电脑归还。
</blockquote>

<table class="layui-table"
       lay-data="{id:'computersTable',width:1320,height:400,url:'/LendingApply/findPassRecord', page:true}"
       lay-filter="test">
    <thead>
    <tr>
        <!--<th lay-data="{field:'laId', width:80}">ID</th>-->
        <th lay-data="{field:'cptName', width:225,sort: true}">电脑</th>
        <th lay-data="{field:'laLendTime', width:110}">借用时间从</th>
        <th lay-data="{field:'laReturnTime', width:110}">借用时间至</th>
        <th lay-data="{field:'eAreturnTime', width:120}">实际归还时间</th>
        <th lay-data="{field:'eIsReturned', width:120}">是否已经归还</th>
        <th lay-data="{field:'eDays', width:120}">实际借用天数</th>
        <th lay-data="{field:'eExpense', width:120}">应缴费用</th>
        <th lay-data="{field:'laIsCheck', width:120}">是否审核通过</th>
        <th lay-data="{field:'attribute1', width:120}">是否已经审核</th>
        <th lay-data="{fixed: 'right', width:160, align:'center', toolbar: '#Toolbar'}">
    </tr>
    </thead>
</table>

<script type="text/html" id="Toolbar">
    <a class="layui-btn layui-btn-xs" lay-event="return">归还</a>
</script>


<script>


    layui.use(['form', 'layedit', 'laydate', 'table'], function () {
        var table = layui.table;
        var form = layui.form
            , layer = layui.layer
            , laydate = layui.laydate;


        //监听工具条
        table.on('tool(test)', function (obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"


            var data = obj.data //获得当前行数据
                , layEvent = obj.event; //获得 lay-event 对应的值
            if (layEvent === 'return') {

                //如果已经归还，不允许重复归还

                if (data.eIsReturned == 'Y') {
                        layer.msg("您已经归还这台电脑，请勿重复操作！");
                } else {

                    var index = layer.confirm('确定要归还电脑吗?', {icon: 3, title: '提示'}, function (index) {

                        $.ajax({
                            url: 'http://localhost:8080/Expense/ReturnCpt?laId=' + data.laId + '&laCptId=' + data.laCptId,
                            type: "GET",
                            dataType: 'json',
                            contentType: 'application/json;charset=UTF-8', //contentType很重要
                            success: function (result) {
                                if (result.flag != -1) {
                                    layer.alert("归还成功，您需要支付" + result.cost + "元，谢谢您的使用!");
                                    table.reload('computersTable', {
                                        url: '/LendingApply/findPassRecord'
                                    });
                                }

                            }
                        })
                    });

                }

            }
        });

    });

    function doReset() {
        //简单粗暴  直接刷新，得到全部的数据 。。。  linsong.wei 2017-11-10 22:47:40
        window.location.reload();
    }

</script>


</body>
</html>